import React, { useEffect, useState } from "react";
import axios from "axios";
import "./Hero.css";
import { Banknote, Cpu, Users, ShieldCheck, Briefcase } from "lucide-react";

const iconMap = {
  financial: Banknote,
  ai: Cpu,
  hr: Users,
  risk: ShieldCheck,
  retirement: Briefcase,
};

// Brand colors
const colors = ["#DF3621", "#FD9E01", "#00B09B", "#FF33CC", "#0099FF"];

const Hero = () => {
  const [events, setEvents] = useState([]);

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const res = await axios.get("http://localhost:8001/api/upcoming-events"); 
        // Expected backend shape: [{ id, label/title, pdf_url, category }]
        setEvents(res.data);
      } catch (err) {
        console.error("Error fetching upcoming events:", err);
      }
    };

    fetchEvents();
  }, []);

  return (
    <section className="hero">
      {/* Left: main hero content */}
      <div className="hero-content">
        <div className="hero-subtitle">
          <p>"Your Integrated Risk "</p>
          <p>"Management Partner"</p>
        </div>

        <p className="hero-desc">
          Premier Hub for Risk Management & Compliance - PhRMC is driving and
          coordinating the implementation of effective Risk Management in all
          organizations.
        </p>
      </div>

      {/* Right: upcoming events image + list */}
      <div className="hero-events">
        <div className="phone-img">
          <img
            src="/images/upcoming-events.png"
            alt="Upcoming Event"
            className="upcoming-img"
          />
        </div>

        <div className="hero-content">
          <p className="upcoming-p">Upcoming Trainings</p>
          <ul className="upcoming-list">
            {events.length > 0 ? (
              events.map((ev, index) => {
                // Try to match icon based on event.category OR fallback
                const Icon = iconMap[ev.category?.toLowerCase()] || Briefcase;
                return (
                  <li
                    key={ev.id}
                    className="upcoming-item"
                    style={{ backgroundColor: colors[index % colors.length] }}
                    role="button"
                    tabIndex={0}
                    onClick={() => window.open(ev.pdf_url, "_blank")}
                    onKeyDown={(e) => {
                      if (e.key === "Enter" || e.key === " ") {
                        window.open(ev.pdf_url, "_blank");
                      }
                    }}
                  >
                    <span>{ev.title || ev.label}</span>
                    {Icon && (
                      <span className="icon-wrapper">
                        <Icon className="w-5 h-5 text-black" />
                      </span>
                    )}
                  </li>
                );
              })
            ) : (
              <p>No upcoming trainings available right now.</p>
            )}
          </ul>

          <button
            className="btn btn-primary"
            onClick={() =>
              document.getElementById("training")?.scrollIntoView({
                behavior: "smooth",
              })
            }
          >
            Explore Programs
          </button>
        </div>
      </div>
    </section>
  );
};

export default Hero;
